<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>施塾-编程游乐场-{% if lang %} {{ lang }} {% endif %}</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="http://apps.bdimg.com/libs/bootstrap/3.3.0/css/bootstrap.min.css">
        <script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="http://apps.bdimg.com/libs/bootstrap/3.3.0/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/codemirror.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/codemirror.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/mode/htmlmixed/htmlmixed.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/mode/css/css.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/mode/javascript/javascript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/mode/xml/xml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/mode/go/go.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/mode/python/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/mode/addon/edit/closetag.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/mode/addon/edit/closebrackets.min.js"></script>
    <!--[if lt IE 9]>
        <script src="http://apps.bdimg.com/libs/html5shiv/3.7/html5shiv.min.js"></script>
    <![endif]-->

		<script>
			$(document).ready(function() {
			    var langParm = "";

			    {% if lang %}
			        langParm = "{{ lang }}";
			    {% endif %}

                var editor_mode = "text/x-"+langParm.toLowerCase();

                var editor = CodeMirror.fromTextArea(document.getElementById("ta_code"), {
                                                                                        mode: editor_mode,
                                                                                        lineNumbers: true,
                                                                                        matchBrackets: true,
                                                                                        indentUnit: 4,
                                                                                        indentWithTabs: true
                                                                                        });

				$("#btn_run").click(function() {
                    loadingdata = '<img src="/staticfiles/loading.gif">'
                    $('#iframeResult').attr("srcdoc", loadingdata);

                    var text = editor.getValue();

                    $.getJSON('/parse/', {code: text, lang: langParm})
                      .done(function(json) {
                          var result = json['msg'];
                          result = result.replace(/\r\n|\r|\n/g,"<br />");
                          var html = '<div>' + json['result'] + '</div>';
                          html += '<div>' + result + '</div>';
                          $('#iframeResult').attr("srcdoc", html);
                      })
                      .fail(function(jqxhr, textStatus, error) {
                          var html = '<div class="alert alert-danger alert-dismissable">'
                              + '<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'
                              + 'load data failed: ' + textStatus + ', ' + error + '</div>';
                          $('#iframeResult').attr("srcdoc", html);
                      });
				});
			});
		</script>

        <style>
            .CodeMirror {
                font-size:12px;
                height:450px;
            }
            #ta_code {
                height: 450px;
            }
            #iframeResult {
                border: 0!important;
                min-width: 100px;
                width: 100%;
                height: 450px;
                background-color: #fff;
            }
            .form-inline {
                padding: 6px 0 2px 0;
            }
        </style>
	</head>
	<body>
        <div class="container" style="width:100%;height:100%;font-size:12px;">
            <div class="row" style="min-height:90px"></div>
            <div class="row" style="background-color: #e5eecc;">
                <div class="panel panel-default" style="margin-bottom:0;">
                    <div class="panel-body" style="background-color: #e5eecc;border-color: #e5eecc;">
                        <form autocomplete="off" role="form">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row-fluid">
                                        <label class="inline"><strong style="font-size: 16px;color: #617f10;">{% if lang %} {{ lang }} {% endif %} 源代码</strong></label>
                                        <button type="button" class="btn btn-default btn-xs pull-right inline" id="btn_run">提交运行 &#187;</button>
                                        <input type="hidden" id="bt" name="bt">
                                        <input type="hidden" id="code" name="code">
                                    </div>
                                    <textarea class="form-control" id="ta_code" name="ta_code"></textarea>
                                </div>
                                <div class="col-sm-6">
                                    <label><strong style="font-size: 16px;color: #617f10;">运行结果</strong></label>
                                    <label class="pull-right"><strong style="font-size: 16px;color: #617f10; text-decoration: underline;">施塾-编程游乐场-{% if lang %} {{ lang }} {% endif %}</strong> </label>
                                    <div id="iframewrapper">
                                        <iframe id="iframeResult" class="result_output" name="view"></iframe>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
	</body>
</html>
